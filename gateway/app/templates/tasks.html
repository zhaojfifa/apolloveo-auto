<!doctype html>
<html lang="zh-CN" class="bg-gray-50">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>{{ t("page.tasks.board.title") }} - ShortVideo</title>

  <!-- Tailwind CDN for PR-UI-1 (board only) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Keep existing i18n + ui skin -->
  <link rel="stylesheet" href="/static/i18n.css" />
  <link rel="stylesheet" href="/static/css/ui_v185.css">

  <style>
    :root { color-scheme: light; }
    body { margin:0; padding: 16px; background:#f3f4f6; color:#0f172a; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .page { max-width: 1200px; margin: 0 auto; }
  </style>
</head>

<body class="{{ 'mobile' if is_mobile else 'desktop' }}">
  <div class="page">
    <header class="mb-4 flex flex-wrap items-center gap-3">
      <div class="flex-1">
        <div class="flex items-center gap-2">
          <h1 class="text-2xl font-bold text-gray-900">{{ t("ui.tasks.board") }}</h1>
          <span class="rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-600">v1.9</span>
        </div>
        <p class="mt-1 text-sm text-gray-500">{{ t("tasks.board.subhead") }}</p>
      </div>
      <div class="flex items-center gap-2">
        {% include "_lang_tabs.html" %}
        <a href="/tasks/new" class="inline-flex items-center rounded-md bg-gray-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-800">
          {{ t("common.new_task") }}
        </a>
      </div>
    </header>

    <div class="mb-2 flex flex-wrap items-center gap-2">
      <div class="inline-flex rounded-lg border border-gray-200 bg-white p-1 text-sm">
        <button class="status-btn rounded-md px-3 py-1.5 data-[active=true]:bg-gray-900 data-[active=true]:text-white"
                data-status="all" data-active="true">{{ t("tasks.filter.status.all") }}</button>
        <button class="status-btn rounded-md px-3 py-1.5 text-gray-700 hover:bg-gray-50"
                data-status="processing">{{ t("tasks.filter.status.processing") }}</button>
        <button class="status-btn rounded-md px-3 py-1.5 text-gray-700 hover:bg-gray-50"
                data-status="done">{{ t("tasks.filter.status.done") }}</button>
        <button class="status-btn rounded-md px-3 py-1.5 text-gray-700 hover:bg-gray-50"
                data-status="attention">{{ t("tasks.filter.status.attention") }}</button>
      </div>
    </div>

    <div class="mb-4 flex flex-wrap items-center gap-2">
      <div class="inline-flex rounded-lg border border-gray-200 bg-white p-1 text-sm">
        <button class="scene-btn rounded-md px-3 py-1.5 data-[active=true]:bg-gray-900 data-[active=true]:text-white"
                data-scene="all" data-active="true">{{ t("tasks.filter.scene.all") }}</button>
        <button class="scene-btn rounded-md px-3 py-1.5 text-gray-700 hover:bg-gray-50"
                data-scene="avatar">{{ t("tasks.filter.scene.avatar") }}</button>
        <button class="scene-btn rounded-md px-3 py-1.5 text-gray-700 hover:bg-gray-50"
                data-scene="hot_follow">{{ t("tasks.filter.scene.hot_follow") }}</button>
        <button class="scene-btn rounded-md px-3 py-1.5 text-gray-700 hover:bg-gray-50"
                data-scene="baseline">{{ t("tasks.filter.scene.baseline") }}</button>
      </div>
      <div class="ml-auto text-sm text-gray-500" id="boardMessage">{{ t("tasks.filtered_n", n=(items|length)) }}</div>
    </div>

    <div class="bg-white shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl">
      <div id="taskList" class="divide-y divide-gray-100">
        {% for it in items %}
          <div class="task-row relative flex justify-between gap-x-6 px-4 py-4 sm:px-6 hover:bg-gray-50 {{ it.row_class }}"
               data-scene="{{ it.scene_key }}" data-status="{{ it.filter_status }}">
            <div class="flex min-w-0 gap-x-4">
              <a href="{{ it.primary_action_href }}" class="h-16 w-16 flex-none rounded-lg bg-gray-200 overflow-hidden flex items-center justify-center">
                {% if it.cover_url %}
                  <img class="h-full w-full object-cover" src="{{ it.cover_url }}" alt="cover" />
                {% else %}
                  <span class="text-gray-400 text-xl"></span>
                {% endif %}
              </a>

              <div class="min-w-0 flex-auto">
                <p class="text-sm font-semibold leading-6 text-gray-900 line-clamp-1">{{ it.title_display }}</p>
                {% if it.subtitle %}
                  <p class="mt-1 flex text-xs leading-5 text-gray-500 gap-2">{{ it.subtitle }}</p>
                {% endif %}

                <div class="mt-1 flex gap-2 flex-wrap">
                  {% if it.show_pack_badge %}
                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset {{ it.pack_badge_class }}">
                      {{ t(it.pack_badge_label_key) }}
                    </span>
                  {% endif %}
                  {% if it.show_video_badge %}
                    <span class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset {{ it.video_badge_class }}">
                      {{ t("tasks.badge.video") }}
                    </span>
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="flex items-center gap-x-4">
              <div class="hidden sm:flex sm:flex-col sm:items-end">
                <p class="text-sm leading-6 text-gray-900">{{ t(it.scene_label_key) }}</p>
                <p class="mt-1 text-xs leading-5 text-gray-500">{{ it.created_label }}</p>
              </div>

              <div class="flex items-center gap-2">
                {% if it.download_class %}
                  <a href="{{ it.pack_download_href }}" target="_blank" rel="noopener" class="{{ it.download_class }}">
                    {{ t(it.download_label_key) }}
                  </a>
                {% else %}
                  <button class="{{ it.download_disabled_class }}">
                    {{ t(it.download_label_key) }}
                  </button>
                {% endif %}

                <a href="{{ it.primary_action_href }}" class="rounded bg-gray-900 px-2 py-1 text-sm font-semibold text-white hover:bg-gray-800">
                  {{ t("action.open_detail") }}
                </a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div id="emptyState" class="hidden p-6 text-center text-sm text-gray-500">
        {{ t("tasks.empty") }}
      </div>
    </div>
  </div>

  <script src="/static/js/i18n_v185.js"></script>
  <script>
    function applyFilters() {
      const rows = Array.from(document.querySelectorAll(".task-row"));
      let shown = 0;
      const curStatus = document.querySelector(".status-btn[data-active='true']")?.dataset.status || "all";
      const curScene = document.querySelector(".scene-btn[data-active='true']")?.dataset.scene || "all";
      rows.forEach((r) => {
        const rs = r.getAttribute("data-status") || "other";
        const rc = r.getAttribute("data-scene") || "baseline";
        const okStatus = (curStatus === "all") ? true : (rs === curStatus);
        const okScene = (curScene === "all") ? true : (rc === curScene);
        const show = okStatus && okScene;
        r.style.display = show ? "" : "none";
        if (show) shown++;
      });
      const msg = document.getElementById("boardMessage");
      if (msg) msg.textContent = {{ t("tasks.filtered_n", n="{n}") | tojson }}.replace("{n}", String(shown));

      const empty = document.getElementById("emptyState");
      if (empty) {
        if (shown === 0) empty.classList.remove("hidden");
        else empty.classList.add("hidden");
      }
    }

    function bindTabs(selector) {
      const btns = Array.from(document.querySelectorAll(selector));
      btns.forEach((b) => {
        b.addEventListener("click", () => {
          btns.forEach(x => x.dataset.active = "false");
          b.dataset.active = "true";
          applyFilters();
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      bindTabs(".status-btn");
      bindTabs(".scene-btn");
      applyFilters();
    });
  </script>
</body>
</html>
